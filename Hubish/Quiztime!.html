<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... (keep existing head content) ... -->
  <style>
    /* Add to existing styles */
    #timer {
      font-size: 1.2em;
      margin-bottom: 20px;
    }
    .disabled-form {
      opacity: 0.5;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="quiz-container">
    <h1>Quiz Time!</h1>
    <div id="timer" class="message"></div>
    <form id="quizForm">
        <!-- Question 1 -->
        <div class="question">
          <p>1. What is the name of the bunker where the black spore originated?</p>
          <div class="options">
            <label><input type="radio" name="q1" value="A"> Hunker Bunker</label>
            <label><input type="radio" name="q1" value="B"> BioLab-Tech</label>
            <label><input type="radio" name="q1" value="C"> Bunker-J</label>
            <label><input type="radio" name="q1" value="D"> Bioweapons-J</label>
          </div>
        </div>
  
        <!-- Question 2 -->
        <div class="question">
          <p>2. What was the name if your tour guide?</p>
          <div class="options">
            <label><input type="radio" name="q2" value="A"> William</label>
            <label><input type="radio" name="q2" value="B"> James</label>
            <label><input type="radio" name="q2" value="C"> Vex</label>
            <label><input type="radio" name="q2" value="D"> Gluurb</label>
          </div>
        </div>
  
        <!-- Question 3 -->
        <div class="question">
          <p>3. What is the worst type of foe to encounter?</p>
          <div class="options">
            <label><input type="radio" name="q3" value="A"> Regular form</label>
            <label><input type="radio" name="q3" value="B"> Fetus from</label>
            <label><input type="radio" name="q3" value="C"> Enraged from</label>
            <label><input type="radio" name="q3" value="D"> Demented form</label>
          </div>
        </div>
  
        <!-- Question 4 -->
        <div class="question">
          <p>4. How does HappyCampers.co gain their tour guides?</p>
          <div class="options">
            <label><input type="radio" name="q4" value="A"> Hire them</label>
            <label><input type="radio" name="q4" value="B"> Pull them from the past</label>
            <label><input type="radio" name="q4" value="C"> Cloning vats</label>
            <label><input type="radio" name="q4" value="D"> Forced Hostage</label>
          </div>
        </div>
  
        <!-- Question 5 -->
        <div class="question">
          <p>5. What is the black spore considered to be?</p>
          <div class="options">
            <label><input type="radio" name="q5" value="A"> A Virus</label>
            <label><input type="radio" name="q5" value="B"> A Spore</label>
            <label><input type="radio" name="q5" value="C"> A Fungus</label>
            <label><input type="radio" name="q5" value="D"> An Animal</label>
          </div>
        </div>
        <!-- Question 6 -->
        <div class="question">
          <p>6. What is the hive?</p>
          <div class="options">
            <label><input type="radio" name="q6" value="A"> A plague</label>
            <label><input type="radio" name="q6" value="B"> A monster</label>
            <label><input type="radio" name="q6" value="C"> A cancer</label>
            <label><input type="radio" name="q6" value="D"> The best thing ever</label>
          </div>
        </div>
  
        <button type="submit">Submit Answers</button>
      </form>
  
      <div id="message" class="message"></div>
      <div id="timer" class="timer"></div> <!-- Timer element -->
    </div>
  </div>
  <script>
    const timerElement = document.getElementById('timer');
    const quizForm = document.getElementById('quizForm');
    let updateInterval;

    function calculateNextValidTime() {
        const now = new Date();
        const currentMinutes = now.getMinutes();
        const currentSeconds = now.getSeconds();
        
        // Calculate next 10-minute mark
        const nextTenMinute = new Date(now);
        nextTenMinute.setMinutes(Math.ceil(currentMinutes / 10) * 10);
        nextTenMinute.setSeconds(0);
        nextTenMinute.setMilliseconds(0);

        // If we're exactly at a 10-minute mark, set to next interval
        if (nextTenMinute.getTime() <= now.getTime()) {
            nextTenMinute.setMinutes(nextTenMinute.getMinutes() + 10);
        }

        return nextTenMinute;
    }

    function updateTimerDisplay() {
        const now = new Date();
        const nextValidTime = calculateNextValidTime();
        const timeDiff = nextValidTime - now;

        if (timeDiff <= 0) {
            // 10-second submission window
            quizForm.classList.remove('disabled-form');
            const windowEnd = new Date(nextValidTime);
            windowEnd.setSeconds(10);
            const remaining = windowEnd - now;
            
            if (remaining > 0) {
                const seconds = Math.floor(remaining / 1000);
                timerElement.innerHTML = `⏳ Submission window open for ${seconds}s<br>
                                        Next window at ${formatTime(nextValidTime)}`;
                timerElement.classList.remove('error');
            } else {
                quizForm.classList.add('disabled-form');
                timerElement.innerHTML = `⌛ Next submission at ${formatTime(nextValidTime)}`;
                timerElement.classList.add('error');
            }
        } else {
            quizForm.classList.add('disabled-form');
            const minutes = Math.floor(timeDiff / 60000);
            const seconds = Math.floor((timeDiff % 60000) / 1000)
                .toString()
                .padStart(2, '0');
            timerElement.innerHTML = `⌛ Next submission at ${formatTime(nextValidTime)}<br>
                                    (${minutes}:${seconds} remaining)`;
            timerElement.classList.add('error');
        }
    }

    function formatTime(date) {
        return date.toLocaleTimeString([], {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: true
        }).toUpperCase();
    }

    // Initial setup
    document.addEventListener('DOMContentLoaded', () => {
        updateTimerDisplay();
        updateInterval = setInterval(updateTimerDisplay, 1000);
    });

    quizForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const now = new Date();
        const nextValidTime = calculateNextValidTime();
        
        // Allow submission if within first 10 seconds of 10-minute interval
        if (now >= nextValidTime && now <= new Date(nextValidTime.getTime() + 10000)) {
            // Your existing submission code
            try {
                const answers = {
                    q1: quizForm.q1.value,
                    q2: quizForm.q2.value,
                    q3: quizForm.q3.value,
                    q4: quizForm.q4.value,
                    q5: quizForm.q5.value,
                    q6: quizForm.q6.value,
                };

                const response = await fetch('https://roboguns-github-io.onrender.com/api/validate-quiz', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(answers),
                });

                const data = await response.json();
                
                if (data.success) {
                    messageElement.textContent = "Congratulations! You got all the answers correct!";
                    messageElement.classList.remove('error');
                } else {
                    messageElement.textContent = data.message || "Some answers are incorrect. Try again!";
                    messageElement.classList.add('error');
                }
            } catch (error) {
                console.error('Error:', error);
                messageElement.textContent = "An error occurred. Please try again.";
                messageElement.classList.add('error');
            }
        } else {
            alert('Submissions are only allowed at 10-minute intervals (XX:00, XX:10, XX:20, etc.)');
        }
    });
</script>
</body>
</html>