<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puzzle Page</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #f0f0f0;
    }

    .puzzle-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .triangle {
      width: 0;
      height: 0;
      border-left: 30px solid transparent;
      border-right: 30px solid transparent;
      border-bottom: 50px solid blue;
      margin: 20px;
      cursor: pointer;
    }

    .top-left { transform: rotate(180deg); }
    .top-right { transform: rotate(270deg); }
    .bottom-left { transform: rotate(90deg); }
    .bottom-right { transform: rotate(0deg); }
  </style>
</head>
<body>
  <div class="puzzle-container">
    <!-- Central triangle layout -->
    <div class="triangle top-left" data-order="1"></div>
    <div class="triangle top-right" data-order="2"></div>
    <div class="triangle bottom-left" data-order="3"></div>
    <div class="triangle bottom-right" data-order="4"></div>
  </div>

  <script>
    let clickedOrder = [];
    let correctOrder = [];

    // Fetch the puzzle sequence from the backend
    fetch('/api/get-sequence')
      .then(response => response.json())
      .then(data => {
        correctOrder = data.sequence; // Dynamically load the correct sequence
      })
      .catch(error => {
        console.error("Failed to fetch sequence:", error);
        alert("Error loading puzzle. Please try again later.");
      });

    const triangles = document.querySelectorAll(".triangle");

    triangles.forEach(triangle => {
      triangle.addEventListener("click", () => {
        // Record the clicked triangle's order
        const order = parseInt(triangle.dataset.order);
        clickedOrder.push(order);

        // Check if the clicked order matches the correct order
        if (clickedOrder.length === correctOrder.length) {
          if (JSON.stringify(clickedOrder) === JSON.stringify(correctOrder)) {
            // If correct, validate with the backend and redirect
            fetch('/api/validate-sequence', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ sequence: clickedOrder })
            })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  // Redirect to hidden page provided by the backend
                  window.location.href = data.redirectURL;
                } else {
                  alert("Validation failed. Try again.");
                  clickedOrder = [];
                }
              })
              .catch(error => {
                console.error("Validation error:", error);
                alert("Error validating sequence. Please try again later.");
              });
          } else {
            alert("Wrong sequence. Try again.");
            clickedOrder = [];
          }
        }
      });
    });
  </script>
</body>
</html>
